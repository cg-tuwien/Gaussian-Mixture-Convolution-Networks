% ---------------------------------------------------------------------------
\documentclass{paper}

\usepackage[T1]{fontenc}

%\usepackage{cite}  % comment out for biblatex with backend=biber 
% ---------------------------



\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{supertabular}
%\usepackage{cite}
%\usepackage[utf8]{inputenc}
\usepackage[font={it},labelfont={bf,up}]{caption}
\usepackage[font={small,it}]{subcaption}
\usepackage{hyperref}
\hypersetup{
	colorlinks=true,
	linkcolor=blue,
	filecolor=magenta,      
	urlcolor=blue,
	citecolor=magenta,
}
% end of prologue

\newcommand{\todo}[1]{{\color{red}\textbf{(TODO: {#1})}}} % Comment for the final version, to raise errors.
\newcommand{\MW}[1]{{\color[rgb]{0,0.7,0}\textbf{(MW: {#1})}}} % Comment for the final version, to raise errors.
\newcommand{\AC}[1]{{\color{magenta}{#1}}} % Comment for the final version, to raise errors.
\newcommand{\abs}[1]{\left| #1 \right|}
\newcommand{\tAbs}[1]{| #1 |}
\newcommand{\F}{\ensuremath{\mathcal{F}}}
\newcommand{\vr}[1]{\ensuremath{\boldsymbol{#1}}}
\newcommand{\tr}[1]{\ensuremath{\boldsymbol{#1}}}
\newcommand{\T}[1]{\ensuremath{{#1}^T}}
\newcommand{\f}[1]{\operatorname{#1}}

\newcommand{\omegavec}[0]{\ensuremath{\vr{\omega{}}}}
\newcommand{\xivec}[0]{\ensuremath{\vr{\xi{}}}}
\newcommand{\xvec}[0]{\ensuremath{\vr{x}}}
\newcommand{\yvec}[0]{\ensuremath{\vr{y}}}
\newcommand{\zvec}[0]{\ensuremath{\vr{z}}}

\newcount\colveccount
\newcommand*\colvec[1]{
	\global\colveccount#1
	\begin{pmatrix}
		\colvecnext
	}
	\def\colvecnext#1{
		#1
		\global\advance\colveccount-1
		\ifnum\colveccount>0
		\\
		\expandafter\colvecnext
		\else
	\end{pmatrix}
	\fi
}

% ---------------------------------------------------------------------

\title{Fourier Transform and Convolution of Gaussian mixtures}
\author{Adam Celarek\\Research Unit of Computer Graphics, TU Wien}

\begin{document}
\maketitle

%-------------------------------------------------------------------------
\section{Definitions}
\subsection*{Notation}
\begin{center}
	\begin{supertabular}{rp{8cm}}
		$a$	& Scalar \\
		$\vr{a}$	& Column vector \\
		$A$			& Matrix \\ 
		$\tr{A}$	& Tensor/Array with more than 2 dimensions, e.g. $\tr{A} \in \mathbb{R}^{L \times M \times N}$ \\ 
		$\tr{A}[:][3][2]$
					& Element of an array.
					The first index is the row, the second a column and the third a slice.
					"$:$" selects all elements in that dimension.
					So in this case the full 3rd column of the second slice. \\ 
		$A^T, \vr{a}^T$
					& Transpose of $A$ and $\vec{a}$ (row vector) \\
		$i$			& Imaginary unit \\
		$\vr{x}, \vr{\omega}$
					& Spatial (time) domain and frequency domain coordinates \\
		$\vr{a}$	& Column vector a \\
		$\f{f}(\vr{x})$
					& Function in spatial space \\
		$\f{F}(\vr{\omega})$
					& Function in Fourier space \\
		$\f{F} = \F \f{f}$
					& Fourier transform \\
		$\f{f} = \F^{-1} \f{F}$
					& Inverse Fourier transform \\
	\end{supertabular}
\end{center}
Zero based indices are used and summation ends at $N-1$.

\subsection*{Gaussian function and mixture model}
We define the multi dimensional Gaussian function as
\begin{align}
\f{g}(\vr{x}, a, \vr{b}, C) = a e^{-\frac{1}{2}(\vr{x}-\vr{b})^TC^{-1}(\vr{x}-\vr{b})},
\end{align}
where $a$ is the height, $\vr{b}$ the shift, and $C$ the shape of the Gaussian.
The factor $\frac{1}{2}$ and the inversion of $C$ are there to make the derivation and subsequent formulae simpler.
This Gaussian would turn into a normal distribution if $a$ were replaced with the inverse of the integral of $e^{-\frac{1}{2}...}$.

A Gaussian mixture is defined as
\begin{align}
	\f{gm}(\vr{x}, \vr{a}, B, \tr{C}) = \sum_{n=0}^{N} \f{g}(\vr{x}, \vr{a}[n], B[:][n], C[:][:][n]),
\end{align}
where $N$ is the number of Gaussians.
Our definition does not include any normalisation.
If desired, this could be included in $\vr{a}$.

We also know the integral of a single dimensional Gaussian \cite{wiki_gaussian_int}:
\begin{align}
	\label{eq:gaussian_integral}
	\int_{\mathbb{R}} a e^{-(x+b)^2 c} dx = a\sqrt{\frac{\pi}{c}}
\end{align}

\subsection*{Fourier transformation and its inverse}
The definition of the Fourier transform is taken from Osgood's lecture notes (be careful, there is the whole book \cite{osgood_book} and separately the corrected version of chapter 8 \cite{osgood_chapter8}, which is the important one for us ):

\begin{align}
	\f{F} (\vr{\omega}) = (\F \f{f}) (\vr{\omega}) &= \int_{\mathbb{R}^n} \f{f}(\vr{x}) e^{-2 \pi i \vr{\omega}^T \vr{x}} d\vr{x} \\
	\f{f} (\vr{x}) = (\F^{-1} \f{F}) (\vr{x}) &= \int_{\mathbb{R}^n} \f{F}(\vr{\omega}) e^{2 \pi i \vr{\omega}^T \vr{x}} d\vr{x}
\end{align}

Properties are:
\begin{itemize}
	\item Scalar linearity: \\
	      $(\F(\alpha \f{f} + \beta \f{g}))(\omega) = \alpha (\F \f{f})(\omega) + \beta (\F \f{g})(\omega)$
	\item Shift / Translation in spatial domain: \\
	      $(\F\f{f}(\vr{x} + \vr{a}))(\vr{\omega}) = e^{2 \pi i \vr{a}^T \vr{\omega}} (\F \f{f})(\vr{\omega})$
	\item General stretch / Transformation in spatial domain:\\
		  $(\F\f{f}(A\vr{x}))(\vr{\omega}) = \frac{1}{\abs{\det(A)}} (\F \f{f}(\vr{x}))((A^{-1})^T\vr{\omega})$
\end{itemize}

\section{Fourier transform of a Gaussian}
We defined a Gaussian as 
\begin{align*}
	\f{g}(\vr{x}, a, \vr{b}, C) = a e^{-\frac{1}{2}(\vr{x}-\vr{b})^T C^{-1}(\vr{x}-\vr{b})},
\end{align*}
but we will ignore the factor $a$ and the shift $\vr{b}$ for now.
These can be reintroduced later via the scalar linearity and shift properties of the Fourier transform.
For a simpler notation we substitute
\begin{align*}
	\xi = -2 \pi i \omegavec
\end{align*}
Therefore we start with
\begin{align*}
	(\F\f{g}(\vr{x}, C))(\frac{\xi}{-2 \pi i}) &= \int_{\mathbb{R}^n} e^{-\frac{1}{2} \vr{x}^T C^{-1} \vr{x}} e^{\vr{\xi}^T \vr{x}} d\vr{x} \\
	&= \int_{\mathbb{R}^n} e^{-\frac{1}{2} \vr{x}^T C^{-1} \vr{x} + \vr{\xi}^T \vr{x}} d\vr{x}.
\end{align*}
We substitute
\begin{align*}
	\vr{x} = \varphi(\vr{y}) &= \vr{y} + C\vr{\xi} \\
	\Bigg( \f{D}\varphi(\yvec) &= \frac{\partial \vr{y} + C\vr{\xi}}{\partial \vr{y}} = I \Bigg)
\end{align*}
Resulting in
\begin{align*}
	(\F\f{g}(\vr{x}, C))(\frac{\xi}{-2 \pi i})
	&= \int_{\mathbb{R}^n} e^{-\frac{1}{2} (\yvec + C\xivec)^T C^{-1} (\yvec + C\xivec) + \xivec^T (\yvec + C\xivec)} \abs{\f{det}(\f{D}\varphi)} d\yvec.
\end{align*}
$\abs{\f{det}(\f{D}\varphi)}$ is 1, and we can reduce the exponent:
\begin{align*}
	&\quad -\frac{1}{2} (\yvec + C\xivec)^T C^{-1} (\yvec + C\xivec) + \xivec^T (\yvec + C\xivec) = \\
	&= -\frac{1}{2} \left( (\yvec^T C^{-1} + \xivec^T)(\yvec + C \xivec) \right) + \xivec^T \yvec + \xivec^T C^{-1} \xivec = \\
	&= -\frac{1}{2} \yvec^T C^{-1} \yvec - \frac{1}{2} \yvec^T \xivec -\frac{1}{2} \xivec^T \yvec -\frac{1}{2} \xivec^T C \xivec + \xivec^T \yvec + \xivec^T C^{-1} \xivec = \\
	&= -\frac{1}{2} \yvec^T C^{-1} \yvec + \frac{1}{2} \xivec^T C \xivec.
\end{align*}
using the fact that A is symmetric.
Putting it back results in
\begin{align}
	\label{eq:fourier_only_gauss_int_left}
	(\F\f{g}(\vr{x}, C))(\frac{\xi}{-2 \pi i})
	&= e^{\frac{1}{2} \xivec^T C \xivec} \int_{\mathbb{R}^n} e^{-\frac{1}{2} \yvec^T C^{-1} \yvec}  d\yvec.
\end{align}
Nice, so we were able to move that $\xivec$ term out of the integral.
Now we have to evaluate it.
For that we use the eigendecomposition of $C$ with orthonormal matrices $Q$ and diagonal eigenvalue matrix $\Lambda$ \cite{wiki_eigendecomp}:
\begin{align*}
	C^{-1} &= (Q \Lambda Q^T)^{-1} = Q \Lambda^{-1} Q^T, \nonumber \\
	\int_{\mathbb{R}^n} e^{-\frac{1}{2} \yvec^T C^{-1} \yvec}  d\yvec
	&= \int_{\mathbb{R}^n} e^{-\frac{1}{2} \yvec^T Q \Lambda^{-1} Q^T \yvec}  d\yvec =  \nonumber \\
	&= \int_{\mathbb{R}^n} e^{-\frac{1}{2} (Q^T \yvec)^T \Lambda^{-1} (Q^T \yvec)}  d\yvec
\end{align*}
and substituting
\begin{align*}
\zvec = \psi(\yvec) &= Q^T \yvec \\
\Bigg( \f{D}\psi(\yvec) &= \frac{\partial Q^T \vr{x}}{\partial \vr{x}} = Q^T \Bigg)
\end{align*}
gives (the determinant is 1 again due to orthonormality of Q \todo{check})
\begin{align*}
	&\quad \int_{\mathbb{R}^n} e^{-\frac{1}{2} \zvec^T \Lambda^{-1} \zvec} \abs{\f{det}(\f{D}\psi(\yvec))} d\yvec =\\
	&= \int_{\mathbb{R}^n} e^{-\frac{1}{2} \zvec^T \Lambda^{-1} \zvec} d\yvec =\\
	&= \int_{\mathbb{R}^n} e^{-\frac{1}{2} \sum_{n} \zvec_n^2 \Lambda_{nn}^{-1} } d\yvec =\\
	&= \int_{\mathbb{R}} e^{-\frac{1}{2} \zvec_1^2 \Lambda_{11}^{-1} } \int_{\mathbb{R}} e^{-\frac{1}{2} \zvec_2^2 \Lambda_{22}^{-1} } \dots \int_{\mathbb{R}} e^{-\frac{1}{2} \zvec_n^2 \Lambda_{nn}^{-1} } d\zvec_n d\zvec_{n-1} \dots d\zvec_1 =\\
	&= \prod_{n} \sqrt{2 \pi \Lambda_{nn}} = \sqrt{(2 \pi)^n \f{det}(C)},
\end{align*}
where we used Equation \ref{eq:gaussian_integral} and the fact that the determinant is equal to the product of the eigenvalues \todo{check}.
Plugging that back into Equation \ref{eq:fourier_only_gauss_int_left} gives us
\begin{align*}
	(\F\f{g}(\vr{x}, C))(\frac{\xi}{-2 \pi i})
	&= e^{\frac{1}{2} \xivec^T C \xivec} \int_{\mathbb{R}^n} e^{-\frac{1}{2} \yvec^T C^{-1} \yvec}  d\yvec = \\
	&= e^{\frac{1}{2} \xivec^T C \xivec} \sqrt{(2 \pi)^n \f{det}(C)}
\end{align*}
and finally, after recovering $\omega$ and friends
\begin{align*}
(\F\f{g}(\vr{x}, C))(\omegavec)
&= e^{\frac{1}{2} (-2 \pi i \omegavec)^T C (-2 \pi i \omegavec)} \sqrt{(2 \pi)^n \f{det}(C)} = \\
&=  e^{2 \pi^2 \omegavec^T C \omegavec} \sqrt{(2 \pi)^n \f{det}(C)}
\end{align*}

\begin{thebibliography}{9}% 2nd arg is the width of the widest label.
	\bibitem{wiki_gaussian_int} \url{https://en.wikipedia.org/w/index.php?title=Gaussian_integral&oldid=920544461}
	\bibitem{wiki_eigendecomp} \url{https://en.wikipedia.org/wiki/Eigendecomposition_of_a_matrix#Eigendecomposition_of_a_matrix}
	\bibitem{osgood_chapter8} \url{https://see.stanford.edu/materials/lsoftaee261/chap8.pdf}
	\bibitem{osgood_book} \url{https://see.stanford.edu/materials/lsoftaee261/book-fall-07.pdf}
\end{thebibliography}

\end{document}
